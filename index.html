<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pro Document Editor & Viewer</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.8.162/pdf.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.4.2/mammoth.browser.min.js"></script>

<style>
body { background-color: #1e1e2f; color: #f0f0f0; font-family: 'Inter', sans-serif; }
.editor-container, .pdf-container, .excel-container { height: 400px; overflow: auto; border: 1px solid #444; border-radius: 0.5rem; padding: 0.5rem; margin-top: 1rem; background-color: #2b2b3b; }
button { background-color: #3b82f6; color: white; padding: 0.5rem 1rem; border-radius: 0.5rem; margin-right: 0.5rem; }
.tabs button { background-color: #3b3b5c; margin-right: 0.25rem; }
.tabs button.active { background-color: #3b82f6; }
</style>
</head>
<body class="p-5">

<h1 class="text-2xl mb-4">ðŸ—‚ Pro Document Editor & Viewer</h1>

<!-- File Upload -->
<input type="file" id="fileInput" class="mb-4" multiple />

<!-- Tabs -->
<div class="tabs mb-4">
  <button class="active" data-tab="textTab">Text/Word</button>
  <button data-tab="pdfTab">PDF</button>
  <button data-tab="excelTab">Excel/CSV</button>
</div>

<!-- Editors/Viewer -->
<div id="textTab" class="editor-container"></div>
<canvas id="pdfTab" class="pdf-container" style="display:none;"></canvas>
<div id="excelTab" class="excel-container" style="display:none;"></div>

<!-- Buttons -->
<div class="mb-4">
  <button id="downloadBtn">Download</button>
  <button id="printBtn">Print</button>
</div>

<script>
const tabs = document.querySelectorAll('.tabs button');
const tabContents = { 
  textTab: document.getElementById('textTab'), 
  pdfTab: document.getElementById('pdfTab'), 
  excelTab: document.getElementById('excelTab') 
};

// Switch Tabs
tabs.forEach(tab => {
  tab.addEventListener('click', () => {
    tabs.forEach(t => t.classList.remove('active'));
    tab.classList.add('active');
    for (let key in tabContents) tabContents[key].style.display = 'none';
    tabContents[tab.dataset.tab].style.display = (tab.dataset.tab==='pdfTab')?'block':'block';
    if(tab.dataset.tab!=='pdfTab') tabContents[tab.dataset.tab].style.display='block';
    if(tab.dataset.tab==='pdfTab') renderPDF(); // re-render if switching back
  });
});

// Initialize Quill Editor
const quill = new Quill('#textTab', { theme: 'snow', modules: { toolbar: [['bold','italic'], ['link','image'], [{ 'list': 'ordered'}, { 'list': 'bullet' }]] } });

// File Handling
const fileInput = document.getElementById('fileInput');
let currentPDF = null;
let currentPDFData = null;

fileInput.addEventListener('change', async (e) => {
  const files = e.target.files;
  for (let file of files) {
    const ext = file.name.split('.').pop().toLowerCase();

    if(ext === 'pdf') {
      currentPDFData = await file.arrayBuffer();
      currentPDF = await pdfjsLib.getDocument({ data: currentPDFData }).promise;
      tabs[1].click(); // switch to PDF tab
      renderPDF();
    }
    else if(ext==='docx'||ext==='doc') {
      const reader = new FileReader();
      reader.onload = async (event) => {
        const arrayBuffer = event.target.result;
        const result = await mammoth.extractRawText({ arrayBuffer });
        quill.setText(result.value);
        tabs[0].click();
      }
      reader.readAsArrayBuffer(file);
    }
    else if(ext==='xlsx'||ext==='xls'||ext==='csv') {
      const data = await file.arrayBuffer();
      const workbook = XLSX.read(data);
      const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
      const html = XLSX.utils.sheet_to_html(firstSheet);
      tabContents.excelTab.innerHTML = html;
      tabs[2].click();
    }
    else {
      const text = await file.text();
      quill.setText(text);
      tabs[0].click();
    }
  }
});

// PDF Rendering
const pdfCanvas = document.getElementById('pdfTab');
const pdfCtx = pdfCanvas.getContext('2d');
async function renderPDF() {
  if(!currentPDF) return;
  const page = await currentPDF.getPage(1);
  const viewport = page.getViewport({ scale: 1.5 });
  pdfCanvas.height = viewport.height;
  pdfCanvas.width = viewport.width;
  await page.render({ canvasContext: pdfCtx, viewport }).promise;
}

// Download
document.getElementById('downloadBtn').addEventListener('click', () => {
  let activeTab = document.querySelector('.tabs button.active').dataset.tab;
  if(activeTab==='textTab'){
    const blob = new Blob([quill.root.innerHTML], {type:'text/html'});
    const url = URL.createObjectURL(blob);
    const a=document.createElement('a'); a.href=url; a.download='document.html'; a.click(); URL.revokeObjectURL(url);
  } else if(activeTab==='excelTab'){
    const blob = new Blob([tabContents.excelTab.innerHTML], {type:'text/html'});
    const url = URL.createObjectURL(blob);
    const a=document.createElement('a'); a.href=url; a.download='spreadsheet.html'; a.click(); URL.revokeObjectURL(url);
  } else if(activeTab==='pdfTab' && currentPDFData){
    const blob = new Blob([currentPDFData], {type:'application/pdf'});
    const url = URL.createObjectURL(blob);
    const a=document.createElement('a'); a.href=url; a.download='document.pdf'; a.click(); URL.revokeObjectURL(url);
  }
});

// Print
document.getElementById('printBtn').addEventListener('click', () => {
  let activeTab = document.querySelector('.tabs button.active').dataset.tab;
  const printWindow = window.open('', '', 'width=800,height=600');
  if(activeTab==='textTab'){
    printWindow.document.write('<html><body style="background:#1e1e2f;color:#f0f0f0;">'+quill.root.innerHTML+'</body></html>');
  } else if(activeTab==='excelTab'){
    printWindow.document.write('<html><body style="background:#1e1e2f;color:#f0f0f0;">'+tabContents.excelTab.innerHTML+'</body></html>');
  } else if(activeTab==='pdfTab' && currentPDFData){
    const blob = new Blob([currentPDFData], {type:'application/pdf'});
    const url = URL.createObjectURL(blob);
    printWindow.location.href = url;
  }
  printWindow.document.close();
  printWindow.print();
});
</script>

</body>
</html>
