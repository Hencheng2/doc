<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Modern Document Editor</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
  <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.8.162/pdf.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.4.2/mammoth.browser.min.js"></script>
  <style>
    body { background-color: #1e1e2f; color: #f0f0f0; font-family: 'Inter', sans-serif; }
    .editor-container { height: 400px; }
    .pdf-viewer { width: 100%; border: 1px solid #444; margin-top: 1rem; overflow: auto; max-height: 500px; }
    button { background-color: #3b82f6; color: white; padding: 0.5rem 1rem; border-radius: 0.5rem; margin-right: 0.5rem; }
  </style>
</head>
<body class="p-5">

  <h1 class="text-2xl mb-4">üìù Modern Document Editor & Viewer</h1>

  <!-- File Upload -->
  <input type="file" id="fileInput" class="mb-4" />

  <!-- Editor -->
  <div id="editor" class="editor-container mb-4"></div>

  <!-- Buttons -->
  <div class="mb-4">
    <button id="downloadBtn">Download</button>
    <button id="printBtn">Print</button>
  </div>

  <!-- PDF Viewer -->
  <canvas id="pdfCanvas" class="pdf-viewer"></canvas>

<script>
  // Initialize Quill Editor
  const quill = new Quill('#editor', {
    theme: 'snow',
    modules: { toolbar: [['bold','italic'], ['link','image'], [{ 'list': 'ordered'}, { 'list': 'bullet' }]] }
  });

  const fileInput = document.getElementById('fileInput');
  const downloadBtn = document.getElementById('downloadBtn');
  const printBtn = document.getElementById('printBtn');
  const pdfCanvas = document.getElementById('pdfCanvas');
  const pdfCtx = pdfCanvas.getContext('2d');

  fileInput.addEventListener('change', async (e) => {
    const file = e.target.files[0];
    if(!file) return;
    const ext = file.name.split('.').pop().toLowerCase();

    if(ext === 'pdf') {
      const arrayBuffer = await file.arrayBuffer();
      const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
      const page = await pdf.getPage(1);
      const viewport = page.getViewport({ scale: 1.5 });
      pdfCanvas.height = viewport.height;
      pdfCanvas.width = viewport.width;
      const renderContext = { canvasContext: pdfCtx, viewport };
      page.render(renderContext);
    }
    else if(ext === 'docx' || ext === 'doc') {
      const reader = new FileReader();
      reader.onload = async (event) => {
        const arrayBuffer = event.target.result;
        const result = await mammoth.extractRawText({ arrayBuffer });
        quill.setText(result.value);
      }
      reader.readAsArrayBuffer(file);
    }
    else if(ext === 'xlsx' || ext === 'xls') {
      const data = await file.arrayBuffer();
      const workbook = XLSX.read(data);
      const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
      const html = XLSX.utils.sheet_to_html(firstSheet);
      quill.root.innerHTML = html;
    }
    else {
      const text = await file.text();
      quill.setText(text);
    }
  });

  downloadBtn.addEventListener('click', () => {
    const blob = new Blob([quill.root.innerHTML], { type: 'text/html' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'document.html';
    a.click();
    URL.revokeObjectURL(url);
  });

  printBtn.addEventListener('click', () => {
    const printWindow = window.open('', '', 'width=800,height=600');
    printWindow.document.write('<html><body style="background:#1e1e2f;color:#f0f0f0;">' + quill.root.innerHTML + '</body></html>');
    printWindow.document.close();
    printWindow.print();
  });
</script>

</body>
</html>
