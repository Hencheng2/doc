<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ultimate Dark Office Suite</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
body{background:#1e1e2f;color:#f0f0f0;font-family:'Inter',sans-serif;margin:0;padding:0;}
.container{padding:1rem;max-width:1400px;margin:auto;}
button{background:#3b82f6;color:white;padding:0.5rem 1rem;border-radius:0.5rem;margin:0.2rem;cursor:pointer;transition:0.2s;}
button:hover{background:#2563eb;}
.tabs button{background:#3b3b5c;margin-right:0.25rem;}
.tabs button.active{background:#3b82f6;}
.editor-container,.excel-container,.pdf-editor{background:#2b2b3b;border-radius:0.5rem;padding:0.5rem;margin-top:1rem;min-height:300px;overflow:auto;border:1px solid #444;color:#f0f0f0;}
.ql-toolbar.ql-snow{background:#3b3b5c;border:1px solid #444;color:#f0f0f0;flex-wrap:wrap;}
.ql-container.ql-snow{background:#2b2b3b;color:#f0f0f0;border:1px solid #444;min-height:200px;}
.ql-picker-label,.ql-picker-item,.ql-stroke,.ql-fill{color:#f0f0f0!important;}
.excel-container table{border-collapse:collapse;width:100%;}
.excel-container td,.excel-container th{border:1px solid #555;padding:0.3rem;color:#f0f0f0;background:#2b2b3b;}
.excel-container td:focus{outline:2px solid #3b82f6;background:#3b3b5c;}
.pdf-editor{white-space:pre-wrap;outline:none;}
.drag-drop{border:2px dashed #3b82f6;padding:2rem;border-radius:0.5rem;text-align:center;cursor:pointer;margin-bottom:1rem;transition:0.2s;}
.drag-drop:hover{background:#3b3b5c;}
</style>
</head>
<body>
<div class="container">
<h1 class="text-2xl mb-4 text-center">ðŸ—‚ Ultimate Dark Office Suite</h1>

<div class="flex flex-wrap gap-2 justify-center mb-4">
  <button id="newText">New Text</button>
  <button id="newExcel">New Excel</button>
  <button id="newPDF">New PDF</button>
  <button id="uploadBtn">Upload</button>
  <button id="downloadBtn">Download</button>
  <button id="printBtn">Print</button>
  <button id="clearBtn">Clear</button>
</div>

<div id="dragDrop" class="drag-drop mb-4">Drag & Drop Files Here or Tap to Browse</div>
<input type="file" id="fileInput" multiple style="display:none;"/>

<div class="tabs mb-4 flex flex-wrap justify-center">
  <button class="active" data-tab="textTab">Word</button>
  <button data-tab="excelTab">Excel</button>
  <button data-tab="pdfTab">PDF</button>
</div>

<div id="textTab" class="editor-container"></div>
<div id="excelTab" class="excel-container" style="display:none;"></div>
<div id="pdfTab" class="pdf-editor" contenteditable="true" style="display:none;"></div>

</div>

<script>
// Tabs
const tabs=document.querySelectorAll('.tabs button');
const editors={ textTab: document.getElementById('textTab'), excelTab: document.getElementById('excelTab'), pdfTab: document.getElementById('pdfTab') };
tabs.forEach(tab=>tab.addEventListener('click',()=>{tabs.forEach(t=>t.classList.remove('active'));tab.classList.add('active');for(let k in editors)editors[k].style.display='none';editors[tab.dataset.tab].style.display='block';}));

// Quill Editor for Word
const quill=new Quill('#textTab',{ theme:'snow', modules:{ toolbar:[
  ['bold','italic','underline','strike'],
  [{ 'font': [] }, { 'size': ['small','normal','large','huge'] }],
  [{ 'color': [] }, { 'background': [] }],
  [{ 'align': [] }],
  ['link','image','video'],
  [{ 'list': 'ordered'}, { 'list': 'bullet' }],
  [{ 'header': [1,2,3,4,5,6,false] }, 'blockquote', 'code-block'],
  ['clean']
] } });

// File Upload
const fileInput=document.getElementById('fileInput');
const dragDrop=document.getElementById('dragDrop');
dragDrop.addEventListener('click',()=>fileInput.click());
dragDrop.addEventListener('dragover',e=>{e.preventDefault();dragDrop.style.background="#3b3b5c";});
dragDrop.addEventListener('dragleave',()=>{dragDrop.style.background="#2b2b3b";});
dragDrop.addEventListener('drop',e=>{e.preventDefault();dragDrop.style.background="#2b2b3b";handleFiles(e.dataTransfer.files);});
fileInput.addEventListener('change',e=>handleFiles(e.target.files));

async function handleFiles(files){
  for(let file of files){
    const ext=file.name.split('.').pop().toLowerCase();
    if(ext==='docx'||ext==='doc'){
      const reader=new FileReader();
      reader.onload=async(e)=>{const arrayBuffer=e.target.result;const result=await mammoth.extractRawText({arrayBuffer});quill.setText(result.value);tabs[0].click();};
      reader.readAsArrayBuffer(file);
    }else if(ext==='xlsx'||ext==='xls'||ext==='csv'){
      const data=await file.arrayBuffer();
      const workbook=XLSX.read(data);
      const firstSheet=workbook.Sheets[workbook.SheetNames[0]];
      editors.excelTab.innerHTML=XLSX.utils.sheet_to_html(firstSheet,{editable:true});
      makeExcelEditable();
      tabs[1].click();
    }else{
      const text=await file.text();
      quill.setText(text);
      tabs[0].click();
    }
  }
}

// New Documents
document.getElementById('newText').addEventListener('click',()=>{ quill.setText(''); tabs[0].click(); });
document.getElementById('newExcel').addEventListener('click',()=>{
  tabs[1].click();
  let html='<table>';
  for(let i=0;i<20;i++){ html+='<tr>'; for(let j=0;j<20;j++) html+='<td contenteditable="true"></td>'; html+='</tr>'; }
  html+='</table>';
  editors.excelTab.innerHTML=html;
});
document.getElementById('newPDF').addEventListener('click',()=>{ editors.pdfTab.innerHTML=''; tabs[2].click(); });

// Excel Editable
function makeExcelEditable(){
  const cells=editors.excelTab.querySelectorAll('td');
  cells.forEach(cell=>{ cell.setAttribute('contenteditable','true'); });
}

// Excel Formulas (basic)
function calculateExcel(){
  const table=editors.excelTab.querySelector('table');
  if(!table) return;
  const rows=table.rows;
  for(let r=0;r<rows.length;r++){
    for(let c=0;c<rows[r].cells.length;c++){
      let val=rows[r].cells[c].innerText.trim();
      if(val.startsWith('=')){
        try{
          val=val.substring(1).replace(/([A-Z]+)(\d+)/g,(m,col,row)=>{
            const colIndex=col.charCodeAt(0)-65;
            const rowIndex=parseInt(row)-1;
            return rows[rowIndex]?.cells[colIndex]?.innerText||0;
          });
          rows[r].cells[c].innerText=eval(val);
        }catch(e){rows[r].cells[c].innerText='ERROR';}
      }
    }
  }
}
setInterval(calculateExcel,1000);

// Download & Print
function downloadBlob(blob,filename){const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download=filename;a.click();URL.revokeObjectURL(url);}
document.getElementById('downloadBtn').addEventListener('click',()=>{
  const activeTab=document.querySelector('.tabs button.active').dataset.tab;
  if(activeTab==='textTab') downloadBlob(new Blob([quill.root.innerHTML],{type:'text/html'}),'document.html');
  else if(activeTab==='excelTab'){
    const table=editors.excelTab.querySelector('table');
    const ws=XLSX.utils.table_to_sheet(table);
    const wb=XLSX.utils.book_new(); XLSX.utils.book_append_sheet(wb,ws,'Sheet1');
    XLSX.writeFile(wb,'spreadsheet.xlsx');
  } else if(activeTab==='pdfTab'){
    const { jsPDF }=window.jspdf;
    const doc=new jsPDF();
    const text=editors.pdfTab.innerText;
    const lines=doc.splitTextToSize(text,180);
    doc.text(lines,10,10);
    doc.save('document.pdf');
  }
});
document.getElementById('printBtn').addEventListener('click',()=>{
  const activeTab=document.querySelector('.tabs button.active').dataset.tab;
  const printWindow=window.open('','','width=800,height=600');
  if(activeTab==='textTab') printWindow.document.write('<html><body style="background:#1e1e2f;color:#f0f0f0;">'+quill.root.innerHTML+'</body></html>');
  else if(activeTab==='excelTab') printWindow.document.write('<html><body style="background:#1e1e2f;color:#f0f0f0;">'+editors.excelTab.innerHTML+'</body></html>');
  else if(activeTab==='pdfTab') printWindow.document.write('<html><body style="background:#1e1e2f;color:#f0f0f0;">'+editors.pdfTab.innerHTML+'</body></html>');
  printWindow.document.close(); printWindow.print();
});

// Clear
document.getElementById('clearBtn').addEventListener('click',()=>{ quill.setText(''); editors.excelTab.innerHTML=''; editors.pdfTab.innerHTML=''; });
</script>
</body>
</html>
